---
layout: post
title: Řazení
---

Řazení v PHP - kdo se má v těch funkcích vyznat?

# Řazení v poli ...

## ...podle hodnot

Začneme základním příkladem - seřadit pole (array) vzestupně podle hodnot, tedy od nejnižší do nejvyšší. Použijeme funkci `sort()`. Pro řazení sestupně použijeme funkci `rsort()` (`r` jako reverse). 

Pozor, tyto dvě funkce poruší vazbu mezi hodnotami a klíči - v poli zůstanou pouze hodnoty. 

Kdybychom chtěli zachovat i klíče, musíme použít funkci `asort()`, případně `arsort()` (`a` jako asociative). 

## ...podle klíčů

Pro vzestupné řazení podle klíčů (keys) musíme použít funkci `ksort()` (`k` jako keys). Obdobně pro seřazení sestupně funkci `krsort()`. Řazení podle klíčů klíče pochopitelně zachovává. 

## ...přirozeně

Občas chceme řadit čísla tak, jak by je seřadil člověk, a ne počítač. Například při řazení položek `["img12.png", "img10.png", "img2.png", "img1.png";]` se při použití běžného `asort()` seřadí jako `[3] => img1.png, [1] => img10.png, [0] => img12.png, [2] => img2.png`, což většinou nechceme. 

Zde musíme použít funkci `natsort()`, popřípadě `natcasesort()` pro necitlivost k velikosti písma, které nám dané pole seřadí očekávatelněji: `[3] => img1.png, [2] => img2.png, [1] => img10.png, [0] => img12.png`. 

## ...podle vlastnosti elementu

Někdy máme pole plné polí, které mají další vlastnosti. Potom chceme seřadit pole nikoliv podle hodnoty (kde jsou jen pole), ale podle hodnoty vevnitř v těchto prvcích. Jak na to?

PHP umožňuje pomocí funkce `usort()` (`u` jako user/uživatelská) tento problém řešit pomocí uživatelsky definované funkce. Ta určí, který prvek je dříve a který v řazení později. Pokud funkce vrátí číslo menší než 0, znamená to, že má být první prvek dříve než druhý. Pokud funkce vrátí `0`, prvky jsou pro potřeby řazení stejné. A pokud vrátí číslo větší než nula, patří první prvek později než druhý. 

Pozor, float se zde převádí na integer a můžou tady vznikat bugy. Je lepší, když anonymní funkce vrací pouze celá, rozumně velká čísla (tedy integery). 

Implementačně se v PHP standardně používá anonymní funkce. Více napoví příklad, který řadí prvky podle jeho vlastnosti `order`. 

```php
<?php

$players = [
	[
		'name' => 'Honza', 
		'order' => 1,
	], [
		'name' => 'Pepa', 
		'order' => 3,
	], [
		'name' => 'Petr', 
		'order' => 2,
	],
];

// u čísel můžeme použít prosté odečtení
usort($players, function($a, $b) {
    return $a['order'] - $b['order'];
});

// od PHP verze 7 použijeme spaceship operátor, pro toto jako dělaný!
usort($players, function($a, $b) {
    return $a['order'] <=> $b['order'];
});

// a řazení vrátí výsledek $players: 
[
	[
		'name' => 'Honza', 
		'order' => 1,
	], [
		'name' => 'Petr', 
		'order' => 2,
	], [
		'name' => 'Pepa', 
		'order' => 3,
	],
];
```

Pozor, anonymní funkce se nespustí, když pole neobsahuje více než dva prvky. Proto tam nikdy nevkládej další logiku, protože by se nemusela provést! Vice v [tomto komentáři v manuálu](https://secure.php.net/manual/en/array.sorting.php#112221). 

## ...náhodně

K řazení patří i rozházení prvků, neboli náhodné řazení. V PHP lze náhodné řazení aplikovat použitím funkce `shuffle()`. 

# Poznámky

 - Všechny představené řadící funkce pracují přímo s předaným polem, nic nevrací. 
 - Řazení v PHP interně používá quicksort (dohledal by někdo zdroj kromě kódu samotného?). 
 - Všechno řazení v PHP je nestabilní (nezachovává se originální řazení prvků, jestliže mají stejnou hodnotu). Stabilní varianty řazení lze najít [v tomto projektu](https://github.com/vanderlee/PHP-stable-sort-functions). 

# Další četba

Přehled řazení je dobře zpracovaný v [manuálu](https://secure.php.net/manual/en/array.sorting.php). Více se o funkci `natsort()` dočteš přímo na [projektu natsort](http://sourcefrog.net/projects/natsort/). 

# Too Long, Didn't Read?
Řazení je v PHP implementováno pomocí rodiny funkce `sort()` pro řazení podle hodnoty nebo klíčů a `usort()` pro řazení podle uživatelské podmínky. Nemá moc smysl implementovat vlastní řazení, v drtivé většině případů bude méně efektivní než vestavěné. 